<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0a0a12" />
  <meta name="screen-orientation" content="landscape" />
  <title>Zombie Courier - 좀비 택배</title>
  <meta name="description" content="좀비 아포칼립스 세계에서 오토바이 택배 기사가 되어 생존자들에게 물품을 배송하라!" />
  <meta property="og:title" content="Zombie Courier - 좀비 택배" />
  <meta property="og:description" content="좀비 아포칼립스 세계에서 오토바이 택배 기사가 되어 생존자들에게 물품을 배송하라!" />
  <meta property="og:type" content="website" />

  <!-- Retro Pixel Font: Press Start 2P -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

  <style>
    @font-face {
      font-family: 'RetroPixel';
      src: local('Press Start 2P'), local('PressStart2P-Regular');
      font-display: swap;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #0a0a12;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
      font-family: 'Press Start 2P', monospace;
      /* Prevent pull-to-refresh on mobile */
      overscroll-behavior: none;
    }

    /* CRT Monitor Frame */
    #game-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    canvas {
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      /* Prevent iOS canvas blurring */
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    /* CRT Scanline Overlay via CSS (on top of canvas) */
    #crt-overlay {
      pointer-events: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.06) 0px,
        rgba(0, 0, 0, 0.06) 1px,
        transparent 1px,
        transparent 3px
      );
      mix-blend-mode: multiply;
    }

    /* CRT Vignette Edge Effect */
    #crt-vignette {
      pointer-events: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 11;
      background: radial-gradient(
        ellipse at center,
        transparent 55%,
        rgba(0, 0, 0, 0.35) 85%,
        rgba(0, 0, 0, 0.65) 100%
      );
    }

    /* CRT Flicker Animation */
    @keyframes crt-flicker {
      0% { opacity: 0.97; }
      5% { opacity: 1; }
      10% { opacity: 0.98; }
      15% { opacity: 1; }
      50% { opacity: 0.99; }
      80% { opacity: 1; }
      90% { opacity: 0.97; }
      100% { opacity: 1; }
    }

    #game-container canvas {
      animation: crt-flicker 8s infinite;
    }

    /* Retro Glow Effect for container */
    #game-container::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border: 1px solid rgba(0, 255, 65, 0.15);
      border-radius: 4px;
      pointer-events: none;
      z-index: 12;
      box-shadow:
        inset 0 0 30px rgba(0, 255, 65, 0.03),
        0 0 15px rgba(0, 255, 65, 0.05);
    }

    /* ─── MOBILE OPTIMIZATIONS ────────────────────── */
    @media (max-width: 768px), (hover: none) and (pointer: coarse) {
      #game-container::before {
        display: none;
      }
      #crt-overlay {
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.04) 0px,
          rgba(0, 0, 0, 0.04) 1px,
          transparent 1px,
          transparent 2px
        );
      }
      /* Reduce CRT flicker on mobile for battery */
      #game-container canvas {
        animation: none;
      }
      /* Lighter vignette on small screens */
      #crt-vignette {
        background: radial-gradient(
          ellipse at center,
          transparent 60%,
          rgba(0, 0, 0, 0.25) 90%,
          rgba(0, 0, 0, 0.5) 100%
        );
      }
    }

    /* Small phone screens (< 480px height in landscape) */
    @media (max-height: 480px) and (orientation: landscape) {
      #crt-overlay {
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.03) 0px,
          rgba(0, 0, 0, 0.03) 1px,
          transparent 1px,
          transparent 2px
        );
      }
    }

    /* ─── ORIENTATION OVERLAY ─────────────────────── */
    #rotate-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0a0a12;
      z-index: 9999;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    #rotate-overlay .rotate-icon {
      width: 60px;
      height: 60px;
      border: 3px solid #00ff41;
      border-radius: 8px;
      position: relative;
      animation: rotate-phone 2s ease-in-out infinite;
    }

    #rotate-overlay .rotate-icon::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 4px;
      background: #00ff41;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    @keyframes rotate-phone {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-90deg); }
      50% { transform: rotate(-90deg); }
      75% { transform: rotate(0deg); }
    }

    #rotate-overlay .rotate-text {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: #00ff41;
      text-align: center;
      line-height: 1.8;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.4);
    }

    #rotate-overlay .rotate-dismiss {
      font-family: 'Press Start 2P', monospace;
      font-size: 7px;
      color: #556666;
      cursor: pointer;
      margin-top: 20px;
    }

    /* Portrait mobile: no longer force landscape.
       The game canvas scales via Phaser.Scale.FIT and is playable in portrait.
       Show a small suggestion banner instead of a blocking overlay. */
    @media (orientation: portrait) and (max-width: 768px) and (hover: none) and (pointer: coarse) {
      #rotate-overlay {
        display: flex;
      }
    }

    /* In portrait, make the suggestion auto-dismiss after animation */
    @media (orientation: portrait) {
      #rotate-overlay {
        /* Semi-transparent instead of opaque, so game is visible behind */
        background: rgba(10, 10, 18, 0.85);
      }
    }

    /* ─── LOADING SCREEN ──────────────────────────── */
    #loading-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0a0a12;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      transition: opacity 0.5s ease;
    }

    #loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #loading-screen .title {
      font-family: 'Press Start 2P', monospace;
      font-size: 12px;
      color: #00ff41;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
      margin-bottom: 24px;
      letter-spacing: 2px;
    }

    #loading-screen .dots {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: #00ff41;
      animation: loading-dots 1.5s infinite;
    }

    @keyframes loading-dots {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
    }

    #loading-screen .dots::after {
      content: '...';
      animation: loading-dots-text 1.5s infinite;
    }

    @keyframes loading-dots-text {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
    }

    /* ─── SAFE AREA FOR NOTCHED PHONES ────────────── */
    @supports (padding: env(safe-area-inset-top)) {
      #game-container {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
    }

    /* ─── FULLSCREEN ──────────────────────────────── */
    body:-webkit-full-screen {
      width: 100vw;
      height: 100vh;
    }
    body:fullscreen {
      width: 100vw;
      height: 100vh;
    }
    /* Hide orientation overlay when in landscape fullscreen */
    body:-webkit-full-screen #rotate-overlay,
    body:fullscreen #rotate-overlay {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="loading-screen">
      <div class="title">ZOMBIE COURIER</div>
      <div class="dots">LOADING</div>
    </div>
  </div>
  <div id="crt-overlay"></div>
  <div id="crt-vignette"></div>

  <!-- Orientation overlay for portrait mobile -->
  <div id="rotate-overlay">
    <div class="rotate-icon"></div>
    <div class="rotate-text">ROTATE YOUR DEVICE<br>기기를 회전하세요</div>
    <div class="rotate-dismiss" id="rotate-dismiss">TAP TO DISMISS</div>
  </div>

  <script>
    // Allow dismissing the rotate overlay by tapping anywhere on it
    var rotateOverlay = document.getElementById('rotate-overlay');
    if (rotateOverlay) {
      rotateOverlay.addEventListener('click', function() {
        rotateOverlay.style.display = 'none';
      });
      // Auto-dismiss the portrait suggestion after 3 seconds
      // (it's just a hint, not a blocker — game is playable in portrait)
      setTimeout(function() {
        if (rotateOverlay.style.display !== 'none') {
          rotateOverlay.style.opacity = '0';
          rotateOverlay.style.transition = 'opacity 0.5s ease';
          setTimeout(function() {
            rotateOverlay.style.display = 'none';
            rotateOverlay.style.opacity = '1';
          }, 500);
        }
      }, 3000);
    }

    // Prevent default touch behaviors that interfere with the game
    document.addEventListener('touchmove', function(e) {
      if (e.target === document.body || e.target.tagName === 'CANVAS') {
        e.preventDefault();
      }
    }, { passive: false });

    // Prevent double-tap zoom on iOS
    var lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      var now = Date.now();
      if (now - lastTouchEnd < 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });

    // Prevent context menu on long press
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
  </script>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
